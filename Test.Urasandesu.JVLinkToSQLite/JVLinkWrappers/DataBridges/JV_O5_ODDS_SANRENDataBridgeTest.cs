// JVLinkToSQLite は、JRA-VAN データラボが提供する競馬データを SQLite データベースに変換するツールです。
// 
// Copyright (C) 2023 Akira Sugiura
// 
// This program is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
// 
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
// 
// You should have received a copy of the GNU General Public License
// along with this program.  If not, see <https://www.gnu.org/licenses/>.
// 
// Additional permission under GNU GPL version 3 section 7
// 
// If you modify this Program, or any covered work, by linking or combining it with 
// ObscUra (or a modified version of that library), containing parts covered 
// by the terms of ObscUra's license, the licensors of this Program grant you 
// additional permission to convey the resulting work.

using NUnit.Framework;
using System.Collections.Generic;
using System.Data.SQLite;
using Urasandesu.JVLinkToSQLite.Basis.Mixins.System.Data;
using Urasandesu.JVLinkToSQLite.JVLinkWrappers;
using Urasandesu.JVLinkToSQLite.JVLinkWrappers.DataBridges;
using static JVData_Struct;

namespace Test.Urasandesu.JVLinkToSQLite.JVLinkWrappers.DataBridges
{
    [TestFixture]
    public class JV_O5_ODDS_SANRENDataBridgeTest
    {
        [Test]
        public void JV_O5_ODDS_SANRENDataBridge_BuildUpCreateTableCommand_can_build_executable_table_creation_command()
        {
            // Arrange
            var dataBridge = NewJV_O5_ODDS_SANRENDataBridge("O552023082820230826010205010000000011117010203014030093010204001521030010205010333083010206004875059010207009287078010208049869140010209016563099010210051550142010211039895128                                                                                                         010304002204040010305013298091010306007236072010307012887090010308048808138010309011470085010310058820145010311041333129                                                                                                         010405000694019010406000240007010407000377011010408014160094010409000775020010410006233068010411003260048                                                                                                         010506002318041010507004463056010508050978141010509008178074010510026217116010511020854110                                                                                                         010607001948036010608037917126010609004028052010610018726105010611009973081                                                                                                         010708044980132010709006276069010710028855119010711017578103                                                                                                         010809083418156010810104273162010811131086165                                                                                                         010910045880133010911028147118                                                                                                         011011070585150                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             020304001557031020305009888079020306005120062020307010976084020308067471148020309020211107020310053349143020311047299137                                                                                                         020405000507015020406000241008020407000436014020408009952080020409001034025020410004928061020411002901044                                                                                                         020506001817034020507003157045020508033985123020509006797071020510024147114020511020301108                                                                                                         020607001489029020608015344097020609003235047020610014800095020611009231077                                                                                                         020708043283130020709005207063020710023772112020711016563099                                                                                                         020809075213151020810061173146020811099739160                                                                                                         020910049333139020911023772112                                                                                                         021011080491154                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             030405000508016030406000246009030407000430013030408012400087030409000873024030410005328064030411002057038                                                                                                         030506001747033030507003228046030508045880133030509004855058030510030792121030511013987092                                                                                                         030607001399028030608029410120030609002718043030610015242096030611005997066                                                                                                         030708045880133030709004256054030710023055111030711011498086                                                                                                         030809088231159030810101956161030811124000164                                                                                                         030910038881127030911016563099                                                                                                         031011086566158                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             040506000051002040507000113004040508004917060040509000236006040510001988037040511000817022                                                                                                         040607000041001040608001922035040609000106003040610000872023040611000413012                                                                                                         040708003742049040709000154005040710001683032040711000664018                                                                                                         040809008387075040810017578103040811016385098                                                                                                         040910003757050040911001318027                                                                                                         041011008120073                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             050607000353010050608012780089050609000787021050610005720065050611002618042                                                                                                         050708020760109050709001276026050710010105082050711004279055                                                                                                         050809046343136050810084963157050811081929155                                                                                                         050910017445102050911006191067                                                                                                         051011043283130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             060708006737070060709000615017060710004056053060711002099039                                                                                                         060809018726105060810037301125060811057350144                                                                                                         060910008402076060911003898051                                                                                                         061011024666115                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             070809026217116070810069515149070811075213151                                                                                                         070910012467088070911004700057                                                                                                         071011033985123                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             080910076467153080911065543147                                                                                                         081011104273162                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             091011030792121                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         00000611738\r\n",
                                                            JVOpenOptions.RealTime);

            using (var conn = new SQLiteConnection("Data Source=:memory:"))
            {
                conn.Open();
                using (var cmd = conn.CreateCommand())
                {
                    // Act
                    var cmdCache = cmd.NewPreparedCache(conn.BeginTransaction());
                    foreach (var bltCmd in dataBridge.BuildUpCreateTableCommand(cmdCache))
                    {
                        bltCmd.ExecuteNonQuery();
                    }

                    // Assert
                    cmd.AssertTableCreation("RT_O5_ODDS_SANREN", JVDataStructColumns.O5);
                    cmd.AssertTableCreation("RT_O5_OddsSanrenInfo", JVDataStructColumns.O5_OddsSanrenInfo);
                }
            }
        }

        [Test]
        public void JV_O5_ODDS_SANRENDataBridge_BuildUpCreateTableCommand_can_create_sql_runs_multiple_times_without_error()
        {
            // Arrange
            var dataBridge = NewJV_O5_ODDS_SANRENDataBridge("O552023082820230826010205010000000011117010203014030093010204001521030010205010333083010206004875059010207009287078010208049869140010209016563099010210051550142010211039895128                                                                                                         010304002204040010305013298091010306007236072010307012887090010308048808138010309011470085010310058820145010311041333129                                                                                                         010405000694019010406000240007010407000377011010408014160094010409000775020010410006233068010411003260048                                                                                                         010506002318041010507004463056010508050978141010509008178074010510026217116010511020854110                                                                                                         010607001948036010608037917126010609004028052010610018726105010611009973081                                                                                                         010708044980132010709006276069010710028855119010711017578103                                                                                                         010809083418156010810104273162010811131086165                                                                                                         010910045880133010911028147118                                                                                                         011011070585150                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             020304001557031020305009888079020306005120062020307010976084020308067471148020309020211107020310053349143020311047299137                                                                                                         020405000507015020406000241008020407000436014020408009952080020409001034025020410004928061020411002901044                                                                                                         020506001817034020507003157045020508033985123020509006797071020510024147114020511020301108                                                                                                         020607001489029020608015344097020609003235047020610014800095020611009231077                                                                                                         020708043283130020709005207063020710023772112020711016563099                                                                                                         020809075213151020810061173146020811099739160                                                                                                         020910049333139020911023772112                                                                                                         021011080491154                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             030405000508016030406000246009030407000430013030408012400087030409000873024030410005328064030411002057038                                                                                                         030506001747033030507003228046030508045880133030509004855058030510030792121030511013987092                                                                                                         030607001399028030608029410120030609002718043030610015242096030611005997066                                                                                                         030708045880133030709004256054030710023055111030711011498086                                                                                                         030809088231159030810101956161030811124000164                                                                                                         030910038881127030911016563099                                                                                                         031011086566158                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             040506000051002040507000113004040508004917060040509000236006040510001988037040511000817022                                                                                                         040607000041001040608001922035040609000106003040610000872023040611000413012                                                                                                         040708003742049040709000154005040710001683032040711000664018                                                                                                         040809008387075040810017578103040811016385098                                                                                                         040910003757050040911001318027                                                                                                         041011008120073                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             050607000353010050608012780089050609000787021050610005720065050611002618042                                                                                                         050708020760109050709001276026050710010105082050711004279055                                                                                                         050809046343136050810084963157050811081929155                                                                                                         050910017445102050911006191067                                                                                                         051011043283130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             060708006737070060709000615017060710004056053060711002099039                                                                                                         060809018726105060810037301125060811057350144                                                                                                         060910008402076060911003898051                                                                                                         061011024666115                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             070809026217116070810069515149070811075213151                                                                                                         070910012467088070911004700057                                                                                                         071011033985123                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             080910076467153080911065543147                                                                                                         081011104273162                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             091011030792121                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         00000611738\r\n",
                                                            JVOpenOptions.RealTime);

            using (var conn = new SQLiteConnection("Data Source=:memory:"))
            {
                conn.Open();
                using (var cmd = conn.CreateCommand())
                {
                    // Act
                    var cmdCache = cmd.NewPreparedCache(conn.BeginTransaction());
                    var bltCmds = new List<SQLitePreparedCommand>();
                    foreach (var bltCmd in dataBridge.BuildUpCreateTableCommand(cmdCache))
                    {
                        bltCmd.ExecuteNonQuery();
                        bltCmds.Add(bltCmd);
                    }

                    // Assert
                    foreach (var bltCmd in bltCmds)
                    {
                        Assert.DoesNotThrow(() => bltCmd.ExecuteNonQuery(), bltCmd.GetLoggingQuery());
                    }
                }
            }
        }

        [Test]
        public void JV_O5_ODDS_SANRENDataBridge_BuildUpCreateTableCommand_should_drop_table_when_realtime_execution()
        {
            // Arrange
            var dataBridge = NewJV_O5_ODDS_SANRENDataBridge("O552023082820230826010205010000000011117010203014030093010204001521030010205010333083010206004875059010207009287078010208049869140010209016563099010210051550142010211039895128                                                                                                         010304002204040010305013298091010306007236072010307012887090010308048808138010309011470085010310058820145010311041333129                                                                                                         010405000694019010406000240007010407000377011010408014160094010409000775020010410006233068010411003260048                                                                                                         010506002318041010507004463056010508050978141010509008178074010510026217116010511020854110                                                                                                         010607001948036010608037917126010609004028052010610018726105010611009973081                                                                                                         010708044980132010709006276069010710028855119010711017578103                                                                                                         010809083418156010810104273162010811131086165                                                                                                         010910045880133010911028147118                                                                                                         011011070585150                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             020304001557031020305009888079020306005120062020307010976084020308067471148020309020211107020310053349143020311047299137                                                                                                         020405000507015020406000241008020407000436014020408009952080020409001034025020410004928061020411002901044                                                                                                         020506001817034020507003157045020508033985123020509006797071020510024147114020511020301108                                                                                                         020607001489029020608015344097020609003235047020610014800095020611009231077                                                                                                         020708043283130020709005207063020710023772112020711016563099                                                                                                         020809075213151020810061173146020811099739160                                                                                                         020910049333139020911023772112                                                                                                         021011080491154                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             030405000508016030406000246009030407000430013030408012400087030409000873024030410005328064030411002057038                                                                                                         030506001747033030507003228046030508045880133030509004855058030510030792121030511013987092                                                                                                         030607001399028030608029410120030609002718043030610015242096030611005997066                                                                                                         030708045880133030709004256054030710023055111030711011498086                                                                                                         030809088231159030810101956161030811124000164                                                                                                         030910038881127030911016563099                                                                                                         031011086566158                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             040506000051002040507000113004040508004917060040509000236006040510001988037040511000817022                                                                                                         040607000041001040608001922035040609000106003040610000872023040611000413012                                                                                                         040708003742049040709000154005040710001683032040711000664018                                                                                                         040809008387075040810017578103040811016385098                                                                                                         040910003757050040911001318027                                                                                                         041011008120073                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             050607000353010050608012780089050609000787021050610005720065050611002618042                                                                                                         050708020760109050709001276026050710010105082050711004279055                                                                                                         050809046343136050810084963157050811081929155                                                                                                         050910017445102050911006191067                                                                                                         051011043283130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             060708006737070060709000615017060710004056053060711002099039                                                                                                         060809018726105060810037301125060811057350144                                                                                                         060910008402076060911003898051                                                                                                         061011024666115                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             070809026217116070810069515149070811075213151                                                                                                         070910012467088070911004700057                                                                                                         071011033985123                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             080910076467153080911065543147                                                                                                         081011104273162                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             091011030792121                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         00000611738\r\n",
                                                            JVOpenOptions.RealTime);

            using (var conn = new SQLiteConnection("Data Source=:memory:"))
            {
                conn.Open();
                using (var cmd = conn.CreateCommand())
                {
                    // Act
                    var cmdCache = cmd.NewPreparedCache(conn.BeginTransaction());
                    foreach (var bltCmd in dataBridge.BuildUpCreateTableCommand(cmdCache))
                    {
                        bltCmd.ExecuteNonQuery();
                    }
                    foreach (var bltCmd in dataBridge.BuildUpInsertCommand(cmdCache))
                    {
                        bltCmd.ExecuteNonQuery();
                    }
                    foreach (var bltCmd in dataBridge.BuildUpCreateTableCommand(cmdCache))
                    {
                        bltCmd.ExecuteNonQuery();
                    }

                    // Assert
                    cmd.AssertRecordsAreEmpty("RT_O5_ODDS_SANREN");
                    cmd.AssertRecordsAreEmpty("RT_O5_OddsSanrenInfo");
                }
            }
        }

        [Test]
        public void JV_O5_ODDS_SANRENDataBridge_BuildUpInsertCommand_can_build_executable_record_insertion_command()
        {
            // Arrange
            var dataBridge = NewJV_O5_ODDS_SANRENDataBridge("O552023082820230826010205010000000011117010203014030093010204001521030010205010333083010206004875059010207009287078010208049869140010209016563099010210051550142010211039895128                                                                                                         010304002204040010305013298091010306007236072010307012887090010308048808138010309011470085010310058820145010311041333129                                                                                                         010405000694019010406000240007010407000377011010408014160094010409000775020010410006233068010411003260048                                                                                                         010506002318041010507004463056010508050978141010509008178074010510026217116010511020854110                                                                                                         010607001948036010608037917126010609004028052010610018726105010611009973081                                                                                                         010708044980132010709006276069010710028855119010711017578103                                                                                                         010809083418156010810104273162010811131086165                                                                                                         010910045880133010911028147118                                                                                                         011011070585150                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             020304001557031020305009888079020306005120062020307010976084020308067471148020309020211107020310053349143020311047299137                                                                                                         020405000507015020406000241008020407000436014020408009952080020409001034025020410004928061020411002901044                                                                                                         020506001817034020507003157045020508033985123020509006797071020510024147114020511020301108                                                                                                         020607001489029020608015344097020609003235047020610014800095020611009231077                                                                                                         020708043283130020709005207063020710023772112020711016563099                                                                                                         020809075213151020810061173146020811099739160                                                                                                         020910049333139020911023772112                                                                                                         021011080491154                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             030405000508016030406000246009030407000430013030408012400087030409000873024030410005328064030411002057038                                                                                                         030506001747033030507003228046030508045880133030509004855058030510030792121030511013987092                                                                                                         030607001399028030608029410120030609002718043030610015242096030611005997066                                                                                                         030708045880133030709004256054030710023055111030711011498086                                                                                                         030809088231159030810101956161030811124000164                                                                                                         030910038881127030911016563099                                                                                                         031011086566158                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             040506000051002040507000113004040508004917060040509000236006040510001988037040511000817022                                                                                                         040607000041001040608001922035040609000106003040610000872023040611000413012                                                                                                         040708003742049040709000154005040710001683032040711000664018                                                                                                         040809008387075040810017578103040811016385098                                                                                                         040910003757050040911001318027                                                                                                         041011008120073                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             050607000353010050608012780089050609000787021050610005720065050611002618042                                                                                                         050708020760109050709001276026050710010105082050711004279055                                                                                                         050809046343136050810084963157050811081929155                                                                                                         050910017445102050911006191067                                                                                                         051011043283130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             060708006737070060709000615017060710004056053060711002099039                                                                                                         060809018726105060810037301125060811057350144                                                                                                         060910008402076060911003898051                                                                                                         061011024666115                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             070809026217116070810069515149070811075213151                                                                                                         070910012467088070911004700057                                                                                                         071011033985123                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             080910076467153080911065543147                                                                                                         081011104273162                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             091011030792121                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         00000611738\r\n",
                                                            JVOpenOptions.RealTime);

            using (var conn = new SQLiteConnection("Data Source=:memory:"))
            {
                conn.Open();
                using (var cmd = conn.CreateCommand())
                {
                    // Act
                    var cmdCache = cmd.NewPreparedCache(conn.BeginTransaction());
                    foreach (var bltCmd in dataBridge.BuildUpCreateTableCommand(cmdCache))
                    {
                        bltCmd.ExecuteNonQuery();
                    }
                    foreach (var bltCmd in dataBridge.BuildUpInsertCommand(cmdCache))
                    {
                        bltCmd.ExecuteNonQuery();
                    }

                    // Assert
                    cmd.AssertRecords("RT_O5_ODDS_SANREN", new List<Dictionary<string, object>>()
                    {
                        new Dictionary<string, object>()
                        {
                            { "headRecordSpec", "O5" },
                            { "headDataKubun", "5" },
                            { "headMakeDate", "20230828" },
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "HappyoTime", "00000000" },
                            { "TorokuTosu", "11" },
                            { "SyussoTosu", "11" },
                            { "SanrenpukuFlag", "7" },
                            { "TotalHyosuSanrenpuku", "00000611738" }
                        },
                    });
                    cmd.AssertRecords("RT_O5_OddsSanrenInfo", new List<Dictionary<string, object>>()
                    {
                        new Dictionary<string, object>()
                        {
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "OddsSanrenInfoIdx", "000" },
                            { "OddsSanrenInfoKumi", "010203" },
                            { "OddsSanrenInfoOdds", "014030" },
                            { "OddsSanrenInfoNinki", "093" }
                        },
                        new Dictionary<string, object>()
                        {
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "OddsSanrenInfoIdx", "001" },
                            { "OddsSanrenInfoKumi", "010204" },
                            { "OddsSanrenInfoOdds", "001521" },
                            { "OddsSanrenInfoNinki", "030" }
                        },
                        new Dictionary<string, object>()
                        {
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "OddsSanrenInfoIdx", "002" },
                            { "OddsSanrenInfoKumi", "010205" },
                            { "OddsSanrenInfoOdds", "010333" },
                            { "OddsSanrenInfoNinki", "083" }
                        },
                        new Dictionary<string, object>()
                        {
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "OddsSanrenInfoIdx", "003" },
                            { "OddsSanrenInfoKumi", "010206" },
                            { "OddsSanrenInfoOdds", "004875" },
                            { "OddsSanrenInfoNinki", "059" }
                        },
                        new Dictionary<string, object>()
                        {
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "OddsSanrenInfoIdx", "004" },
                            { "OddsSanrenInfoKumi", "010207" },
                            { "OddsSanrenInfoOdds", "009287" },
                            { "OddsSanrenInfoNinki", "078" }
                        },
                        new Dictionary<string, object>()
                        {
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "OddsSanrenInfoIdx", "005" },
                            { "OddsSanrenInfoKumi", "010208" },
                            { "OddsSanrenInfoOdds", "049869" },
                            { "OddsSanrenInfoNinki", "140" }
                        },
                        new Dictionary<string, object>()
                        {
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "OddsSanrenInfoIdx", "006" },
                            { "OddsSanrenInfoKumi", "010209" },
                            { "OddsSanrenInfoOdds", "016563" },
                            { "OddsSanrenInfoNinki", "099" }
                        },
                        new Dictionary<string, object>()
                        {
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "OddsSanrenInfoIdx", "007" },
                            { "OddsSanrenInfoKumi", "010210" },
                            { "OddsSanrenInfoOdds", "051550" },
                            { "OddsSanrenInfoNinki", "142" }
                        },
                        new Dictionary<string, object>()
                        {
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "OddsSanrenInfoIdx", "008" },
                            { "OddsSanrenInfoKumi", "010211" },
                            { "OddsSanrenInfoOdds", "039895" },
                            { "OddsSanrenInfoNinki", "128" }
                        },
                    });
                }
            }
        }

        [Test]
        public void JV_O5_ODDS_SANRENDataBridge_BuildUpInsertCommand_can_create_an_insert_command_that_overwrites_at_multiple_executions()
        {
            // Arrange
            var dataBridge1 = NewJV_O5_ODDS_SANRENDataBridge("O552023082820230826010205010000000011117010203014030093010204001521030010205010333083010206004875059010207009287078010208049869140010209016563099010210051550142010211039895128                                                                                                         010304002204040010305013298091010306007236072010307012887090010308048808138010309011470085010310058820145010311041333129                                                                                                         010405000694019010406000240007010407000377011010408014160094010409000775020010410006233068010411003260048                                                                                                         010506002318041010507004463056010508050978141010509008178074010510026217116010511020854110                                                                                                         010607001948036010608037917126010609004028052010610018726105010611009973081                                                                                                         010708044980132010709006276069010710028855119010711017578103                                                                                                         010809083418156010810104273162010811131086165                                                                                                         010910045880133010911028147118                                                                                                         011011070585150                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             020304001557031020305009888079020306005120062020307010976084020308067471148020309020211107020310053349143020311047299137                                                                                                         020405000507015020406000241008020407000436014020408009952080020409001034025020410004928061020411002901044                                                                                                         020506001817034020507003157045020508033985123020509006797071020510024147114020511020301108                                                                                                         020607001489029020608015344097020609003235047020610014800095020611009231077                                                                                                         020708043283130020709005207063020710023772112020711016563099                                                                                                         020809075213151020810061173146020811099739160                                                                                                         020910049333139020911023772112                                                                                                         021011080491154                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             030405000508016030406000246009030407000430013030408012400087030409000873024030410005328064030411002057038                                                                                                         030506001747033030507003228046030508045880133030509004855058030510030792121030511013987092                                                                                                         030607001399028030608029410120030609002718043030610015242096030611005997066                                                                                                         030708045880133030709004256054030710023055111030711011498086                                                                                                         030809088231159030810101956161030811124000164                                                                                                         030910038881127030911016563099                                                                                                         031011086566158                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             040506000051002040507000113004040508004917060040509000236006040510001988037040511000817022                                                                                                         040607000041001040608001922035040609000106003040610000872023040611000413012                                                                                                         040708003742049040709000154005040710001683032040711000664018                                                                                                         040809008387075040810017578103040811016385098                                                                                                         040910003757050040911001318027                                                                                                         041011008120073                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             050607000353010050608012780089050609000787021050610005720065050611002618042                                                                                                         050708020760109050709001276026050710010105082050711004279055                                                                                                         050809046343136050810084963157050811081929155                                                                                                         050910017445102050911006191067                                                                                                         051011043283130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             060708006737070060709000615017060710004056053060711002099039                                                                                                         060809018726105060810037301125060811057350144                                                                                                         060910008402076060911003898051                                                                                                         061011024666115                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             070809026217116070810069515149070811075213151                                                                                                         070910012467088070911004700057                                                                                                         071011033985123                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             080910076467153080911065543147                                                                                                         081011104273162                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             091011030792121                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         00000611738\r\n",
                                                             JVOpenOptions.RealTime);
            var dataBridge2 = NewJV_O5_ODDS_SANRENDataBridge("O552023082820230826010205010000000011117010203014031093010204001521030010205010333083010206004875059010207009287078010208049869140010209016563099010210051550142010211039895128                                                                                                         010304002204040010305013298091010306007236072010307012887090010308048808138010309011470085010310058820145010311041333129                                                                                                         010405000694019010406000240007010407000377011010408014160094010409000775020010410006233068010411003260048                                                                                                         010506002318041010507004463056010508050978141010509008178074010510026217116010511020854110                                                                                                         010607001948036010608037917126010609004028052010610018726105010611009973081                                                                                                         010708044980132010709006276069010710028855119010711017578103                                                                                                         010809083418156010810104273162010811131086165                                                                                                         010910045880133010911028147118                                                                                                         011011070585150                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             020304001557031020305009888079020306005120062020307010976084020308067471148020309020211107020310053349143020311047299137                                                                                                         020405000507015020406000241008020407000436014020408009952080020409001034025020410004928061020411002901044                                                                                                         020506001817034020507003157045020508033985123020509006797071020510024147114020511020301108                                                                                                         020607001489029020608015344097020609003235047020610014800095020611009231077                                                                                                         020708043283130020709005207063020710023772112020711016563099                                                                                                         020809075213151020810061173146020811099739160                                                                                                         020910049333139020911023772112                                                                                                         021011080491154                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             030405000508016030406000246009030407000430013030408012400087030409000873024030410005328064030411002057038                                                                                                         030506001747033030507003228046030508045880133030509004855058030510030792121030511013987092                                                                                                         030607001399028030608029410120030609002718043030610015242096030611005997066                                                                                                         030708045880133030709004256054030710023055111030711011498086                                                                                                         030809088231159030810101956161030811124000164                                                                                                         030910038881127030911016563099                                                                                                         031011086566158                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             040506000051002040507000113004040508004917060040509000236006040510001988037040511000817022                                                                                                         040607000041001040608001922035040609000106003040610000872023040611000413012                                                                                                         040708003742049040709000154005040710001683032040711000664018                                                                                                         040809008387075040810017578103040811016385098                                                                                                         040910003757050040911001318027                                                                                                         041011008120073                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             050607000353010050608012780089050609000787021050610005720065050611002618042                                                                                                         050708020760109050709001276026050710010105082050711004279055                                                                                                         050809046343136050810084963157050811081929155                                                                                                         050910017445102050911006191067                                                                                                         051011043283130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             060708006737070060709000615017060710004056053060711002099039                                                                                                         060809018726105060810037301125060811057350144                                                                                                         060910008402076060911003898051                                                                                                         061011024666115                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             070809026217116070810069515149070811075213151                                                                                                         070910012467088070911004700057                                                                                                         071011033985123                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             080910076467153080911065543147                                                                                                         081011104273162                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             091011030792121                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         00000611738\r\n",
                                                             JVOpenOptions.RealTime);

            using (var conn = new SQLiteConnection("Data Source=:memory:"))
            {
                conn.Open();
                using (var cmd = conn.CreateCommand())
                {
                    // Act
                    var cmdCache = cmd.NewPreparedCache(conn.BeginTransaction());
                    foreach (var bltCmd in dataBridge1.BuildUpCreateTableCommand(cmdCache))
                    {
                        bltCmd.ExecuteNonQuery();
                    }
                    foreach (var bltCmd in dataBridge1.BuildUpInsertCommand(cmdCache))
                    {
                        bltCmd.ExecuteNonQuery();
                    }
                    foreach (var bltCmd in dataBridge2.BuildUpInsertCommand(cmdCache))
                    {
                        bltCmd.ExecuteNonQuery();
                    }

                    // Assert
                    cmd.AssertRecords("RT_O5_ODDS_SANREN", new List<Dictionary<string, object>>()
                    {
                        new Dictionary<string, object>()
                        {
                            { "headRecordSpec", "O5" },
                            { "headDataKubun", "5" },
                            { "headMakeDate", "20230828" },
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "HappyoTime", "00000000" },
                            { "TorokuTosu", "11" },
                            { "SyussoTosu", "11" },
                            { "SanrenpukuFlag", "7" },
                            { "TotalHyosuSanrenpuku", "00000611738" }
                        },
                    });
                    cmd.AssertRecords("RT_O5_OddsSanrenInfo", new List<Dictionary<string, object>>()
                    {
                        new Dictionary<string, object>()
                        {
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "OddsSanrenInfoIdx", "000" },
                            { "OddsSanrenInfoKumi", "010203" },
                            { "OddsSanrenInfoOdds", "014031" },
                            { "OddsSanrenInfoNinki", "093" }
                        },
                        new Dictionary<string, object>()
                        {
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "OddsSanrenInfoIdx", "001" },
                            { "OddsSanrenInfoKumi", "010204" },
                            { "OddsSanrenInfoOdds", "001521" },
                            { "OddsSanrenInfoNinki", "030" }
                        },
                        new Dictionary<string, object>()
                        {
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "OddsSanrenInfoIdx", "002" },
                            { "OddsSanrenInfoKumi", "010205" },
                            { "OddsSanrenInfoOdds", "010333" },
                            { "OddsSanrenInfoNinki", "083" }
                        },
                        new Dictionary<string, object>()
                        {
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "OddsSanrenInfoIdx", "003" },
                            { "OddsSanrenInfoKumi", "010206" },
                            { "OddsSanrenInfoOdds", "004875" },
                            { "OddsSanrenInfoNinki", "059" }
                        },
                        new Dictionary<string, object>()
                        {
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "OddsSanrenInfoIdx", "004" },
                            { "OddsSanrenInfoKumi", "010207" },
                            { "OddsSanrenInfoOdds", "009287" },
                            { "OddsSanrenInfoNinki", "078" }
                        },
                        new Dictionary<string, object>()
                        {
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "OddsSanrenInfoIdx", "005" },
                            { "OddsSanrenInfoKumi", "010208" },
                            { "OddsSanrenInfoOdds", "049869" },
                            { "OddsSanrenInfoNinki", "140" }
                        },
                        new Dictionary<string, object>()
                        {
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "OddsSanrenInfoIdx", "006" },
                            { "OddsSanrenInfoKumi", "010209" },
                            { "OddsSanrenInfoOdds", "016563" },
                            { "OddsSanrenInfoNinki", "099" }
                        },
                        new Dictionary<string, object>()
                        {
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "OddsSanrenInfoIdx", "007" },
                            { "OddsSanrenInfoKumi", "010210" },
                            { "OddsSanrenInfoOdds", "051550" },
                            { "OddsSanrenInfoNinki", "142" }
                        },
                        new Dictionary<string, object>()
                        {
                            { "idYear", "2023" },
                            { "idMonthDay", "0826" },
                            { "idJyoCD", "01" },
                            { "idKaiji", "02" },
                            { "idNichiji", "05" },
                            { "idRaceNum", "01" },
                            { "OddsSanrenInfoIdx", "008" },
                            { "OddsSanrenInfoKumi", "010211" },
                            { "OddsSanrenInfoOdds", "039895" },
                            { "OddsSanrenInfoNinki", "128" }
                        },
                    });
                }
            }
        }

        private static JV_O5_ODDS_SANRENDataBridge NewJV_O5_ODDS_SANRENDataBridge(string buf, JVOpenOptions options)
        {
            var dataStruct = new JV_O5_ODDS_SANREN();
            dataStruct.SetDataB(ref buf);
            var dataBridge = new JV_O5_ODDS_SANRENDataBridge();
            dataBridge.SetProperties(dataStruct, options);
            return dataBridge;
        }
    }
}